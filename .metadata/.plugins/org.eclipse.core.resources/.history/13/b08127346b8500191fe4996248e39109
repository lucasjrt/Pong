package br.facom.ufu.poo;

import java.awt.Color;
import java.awt.Graphics;
import java.awt.GraphicsDevice;
import java.awt.GraphicsEnvironment;
import java.awt.Image;
import java.awt.Panel;
import java.awt.Rectangle;
import java.awt.event.KeyEvent;
import java.awt.event.KeyListener;

import javax.swing.JFrame;

import br.facom.ufu.poo.objetos.FBola;
import br.facom.ufu.poo.objetos.FJogador;

public class Pong extends Panel implements Runnable {
	private static final long serialVersionUID = 1L;

	// Constantes
	private final int FPS = 100;
	public static final Rectangle BLOCO_PEQUENO = new Rectangle(10, 30);
	public static final Rectangle BLOCO_MEDIO = new Rectangle(10, 50);
	public static final Rectangle BLOCO_GRANDE = new Rectangle(10, 70);

	public final int LARGURA_TELA;
	public final int ALTURA_TELA;

	private Thread thread;
	private Image img;
	private Graphics g;

	private FBola bola;
	private FJogador j;

	public Pong() {
		JFrame frame = new JFrame("Test");
		GraphicsDevice device = GraphicsEnvironment.getLocalGraphicsEnvironment().getScreenDevices()[0];
		frame.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
		frame.setResizable(false);
		frame.add(this);
		frame.setUndecorated(true);
		frame.setExtendedState(JFrame.MAXIMIZED_BOTH);
		device.setFullScreenWindow(frame);
		LARGURA_TELA = frame.getWidth();
		ALTURA_TELA = frame.getHeight();
		setSize(LARGURA_TELA, ALTURA_TELA);
		frame.setSize(LARGURA_TELA, ALTURA_TELA);
		frame.setLocationRelativeTo(null);
		frame.setVisible(true);
		requestFocus();
		addKeyListener(new KeyListener() {
			public void keyTyped(KeyEvent e) {}
			public void keyReleased(KeyEvent e) {
				if(e.getKeyCode() == KeyEvent.VK_ESCAPE ) {
					System.exit(0);
				}
			}
			public void keyPressed(KeyEvent e) {}
		});
	}

	public void init() {
		bola = new FBola();
		bola.setPosicao(LARGURA_TELA >> 1, ALTURA_TELA >> 1);
		j = new FJogador(this, 0, new Rectangle(10, 525));
		img = createImage(LARGURA_TELA, ALTURA_TELA);
		g = img.getGraphics();
	}

	public void start() {
		thread = new Thread(this, "Game");
		thread.start();
	}

	public void stop() {
		thread.interrupt();
	}

	public void paint(Graphics g) {
		g.drawImage(img, 0, 0, LARGURA_TELA, ALTURA_TELA, this);
	}

	public void update(Graphics g) {
		paint(g);
	}

	@Override
	public void run() {
		int y1 = 0;
		int y2 = ALTURA_TELA;

		try {
			while (true) {
				g.setColor(Color.black);
				g.fillRect(0, 0, LARGURA_TELA, ALTURA_TELA);
				bola.draw(g);
				j.draw(g);
				g.drawLine(0, y1, LARGURA_TELA, y1);
				g.drawLine(0, ALTURA_TELA >> 1, LARGURA_TELA, ALTURA_TELA >> 1);
				g.drawLine(0, y2, LARGURA_TELA, y2);
				if (y1 == ALTURA_TELA >> 1) {
					y1 = 0;
				} else {
					y1++;
				}
				if (y2 == ALTURA_TELA >> 1) {
					y2 = ALTURA_TELA;
				} else {
					y2--;
				}
				repaint();
				Thread.sleep((int) (1000 / FPS));
				// bloco.move(bloco.getX() + 1, bloco.getY() + 1);
			}
		} catch (InterruptedException ie) {
			System.err.print("Interrupted!\n" + ie);
		}
	}

	public static void main(String args[]) {
		Pong t = new Pong();
		t.init();
		t.start();
	}
}
